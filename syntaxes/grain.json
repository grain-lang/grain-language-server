{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Grain",
	"patterns": [
		{
			"include": "#top-level-statements"
		}
	],
	"repository": {
		"bindings": {
			"patterns": [
				{
					"match": "\\b(let\\b\\s*rec|let)\\b\\s*([a-z]\\w*)\\s*(:.*)?(=)(?=.*=>)",
					"captures": {
						"1": {
							"name": "storage.type.grain"
						},
						"2": {
							"name": "entity.name.function.grain"
						},
						"3": {
							"patterns": [
								{ "include": "#type-annotations" }
							]
						},
						"4": {
							"name": "keyword.operator.grain"
						}
					}
				},
				{
					"comment": "Support for highlighting while typing a function definition.",
					"begin": "\\b(let\\b\\s*rec|let)\\b\\s*([a-z]\\w*)\\s*(:.*)?(=)\\s*\\(",
					"end": "\\)",
					"beginCaptures": {
						"1": {
							"name": "storage.type.grain"
						},
						"2": {
							"name": "entity.name.function.grain"
						},
						"3": {
							"patterns": [
								{ "include": "#type-annotations" }
							]
						},
						"4": {
							"name": "keyword.operator.grain"
						}
					},
					"patterns": [
						{ "include": "#binding-destructure" }
					]
				},
				{
					"match": "\\b(let\\b\\s*rec|let)\\b\\s*([a-z]\\w*)\\s*(:.*)?(=)(?=\\s*pattern\\b)",
					"captures": {
						"1": {
							"name": "storage.type.grain"
						},
						"2": {
							"name": "entity.name.function.grain"
						},
						"3": {
							"patterns": [{
								"include": "#type-annotations"
							}]
						},
						"4": {
							"name": "keyword.operator.grain"
						}
					}
				},
				{
					"begin": "\\b(let\\b\\s*rec|let)\\b\\s*\\(",
					"end": "\\)\\s*(:.*)?(=)",
					"beginCaptures": {
						"1": { "name": "storage.type.grain" }
					},
					"endCaptures": {
						"1": {
							"patterns": [{
								"include": "#type-annotations"
							}]
						},
						"2": { "name": "keyword.operator.grain" }
					},
					"patterns": [
						{ "include": "#binding-destructure" }
					]
				},
				{
					"match": "\\b(let\\b\\s*rec|let)\\s*([a-z]\\w*)\\s*(:.*)?(=)",
					"captures": {
						"1": {
							"name": "storage.type.grain"
						},
						"2": {
							"name": "variable.name.grain"
						},
						"3": {
							"patterns": [{
								"include": "#type-annotations"
							}]
						},
						"4": {
							"name": "keyword.operator.grain"
						}
					}
				},
				{
					"match": "\\b(let\\b\\s*rec|let)\\s*([a-z]\\w*)\\b\\s*(:.*)?",
					"captures": {
						"1": {
							"name": "storage.type.grain"
						},
						"2": {
							"name": "variable.name.grain"
						},
						"3": {
							"patterns": [
								{ "include": "#type-annotations" }
							]
						}
					}
				}
			]
		},
		"binding-destructure": {
			"patterns": [
				{
					"begin": "(?=\\()",
					"end": "(?<=\\))",
					"patterns": [
						{ "include": "#binding-destructure" }
					]
				},
				{ "include": "#typed-identifier" }
			]
		},
		"comments": {
			"match": "#.*$",
			"name": "comment.line.grain"
		},
		"type-args": {
			"patterns": [{
				"match": "([a-z]\\w*)(,)?",
				"captures": {
					"1": { "name": "variable.parameter.grain" },
					"2": { "name": "punctuation.definition.parameters.begin.grain" }
				}
			}]
		},
		"type-constructor": {
			"patterns": [{
				"match": "([A-Z]\\w*)\\s*((<).*(>))?",
				"captures": {
					"1": {
						"name": "entity.name.type.grain"
					},
					"2": {
						"patterns": [
							{ "include": "#type-vector" }
						]
					}
				}
			}]
		},
		"type": {
			"patterns": [
				{
					"begin": "(\\()",
					"end": "(\\))",
					"beginCaptures": {
						"1": { "name": "punctuation.definition.parameters.begin.grain" }
					},
					"endCaptures": {
						"1": { "name": "punctuation.definition.parameters.end.grain" }
					},
					"patterns": [
						{
							"match": "(,)",
							"captures": {
								"1": {
									"name": "punctuation.definition.parameters.grain"
								}
							}
						},
						{ "include": "#type" }
					]
				},
				{ "include": "#type-args" },
				{ "include": "#type-constructor" }
			]
		},
		"type-annotations": {
			"patterns": [
				{
					"match": "(:)",
					"captures": {
						"1": { "name": "keyword.operator.grain" }
					}
				},
				{
					"match": "(.*)(->)(.*)",
					"captures": {
						"1": { 
							"patterns": [
								{ "include": "#type-annotations" }
							]
						},
						"2": { "name": "keyword.operator.grain" },
						"3": { 
							"patterns": [
								{ "include": "#type-annotations" }
							]
						}
					}
				},
				{
					"include": "#type"
				}
			]
		},
		"data-declarations": {
			"patterns": [
				{
					"match": "\\b(data)\\b\\s+\\b([A-Z]\\w*)\\b\\s*=\\s*\\b([A-Z]\\w*)\\b",
					"captures": {
						"1": { "name": "storage.type.grain" },
						"2": { "name": "entity.name.type.grain" },
						"3": { "name": "support.type.grain" }
					}
				},
				{
					"begin": "(data)\\s+([A-Z]\\w*)(?=\\s*(<.*>\\s*)?=\\s*\\b([A-Z]\\w*)\\b\\s*\\(.*\\))",
					"end": "(?<=\\))",
					"beginCaptures": {
						"1": { "name": "storage.type.grain" },
						"2": { "name": "entity.name.type.grain" }
					},
					"patterns": [
						{ "include": "#type-vector" },
						{ "include": "#type-variant" }
					]
				},
				{
					"begin": "(data)\\s+([A-Z]\\w*)\\s*=",
					"end": "([A-Z]\\w*(\\(.*\\))?)",
					"beginCaptures": {
						"1": { "name": "storage.type.grain" },
						"2": { "name": "entity.name.type.grain" }
					},
					"endCaptures": {
						"1": {
							"patterns": [
								{ "include": "#type-variant" }
							]
						}
					}
				},
				{
					"begin": "(data)\\s+([A-Z]\\w*)",
					"end": "=",
					"beginCaptures": {
						"1": { "name": "storage.type.grain" },
						"2": { "name": "entity.name.type.grain" }
					},
					"patterns": [
						{ "include": "#type-vector" }
					]
				},
				{
					"begin": "(?=\\|\\s*\\b([A-Z]\\w*)\\b\\s*\\()",
					"end": "(?<=\\))",
					"patterns": [
						{ "include": "#type-variant" }
					]
				},
				{
					"match": "\\|\\s*\\b([A-Z]\\w*)\\b",
					"captures": {
						"1": {
							"name": "support.type.grain"
						}
					}
				}
			]
		},
		"function": {
			"patterns": [
				{
					"begin": "(\\()(?=.*=>)",
					"end": "(\\))\\s*(=>)",
					"beginCaptures": {
						"1": { "name": "punctuation.definition.parameters.begin.grain" }
					},
					"endCaptures": {
						"1": { "name": "punctuation.definition.parameters.end.grain" },
						"2": { "name": "keyword.operator.grain" }
					},
					"patterns": [
						{ "include": "#binding-destructure" }
					]
				}
			]
		},
		"function-call": {
			"patterns": [
				{
					"begin": "\\b([a-z]\\w*)\\b\\s*(\\()",
					"end": "(\\))",
					"beginCaptures": {
						"1": { "name": "entity.name.function.grain" },
						"2": { "name": "meta.function-call.grain" }
					},
					"endCaptures": {
						"1": { "name": "meta.function-call.grain" }
					},
					"patterns": [
						{
							"match": ",",
							"name": "meta.function-call.grain"
						},
						{ "include": "#expressions" }
					]
				}
			]
		},
		"block": {
			"patterns": [
				{
					"name": "grblock",
					"begin": "(\\{)",
					"end": "(\\})",
					"beginCaptures": {
						"1": { "name": "punctuation.definition.parameters.begin.grain" }
					},
					"endCaptures": {
						"1": { "name": "punctuation.definition.parameters.end.grain" }
					},
					"patterns": [
						{ "include": "#expressions" }
					]
				}
			]
		},
		"expressions": {
			"patterns": [
				{ "include": "#comments" },
				{ "include": "#bindings" },
				{ "include": "#function" },
				{ "include": "#type-variant-constructor" },
				{ "include": "#tuple" },
				{ "include": "#match" },
				{ "include": "#pattern" },
				{ "include": "#block" },
				{ "include": "#function-call" },
				{ "include": "#keywords" },
				{ "include": "#constant" },
				{ "include": "#identifier" }
			]
		},
		"identifier": {
			"patterns": [
				{
					"match": "\\b[a-z]\\w*\\b",
					"name": "variable.name.grain"
				}
			]
		},
		"typed-identifier": {
			"patterns": [
				{
					"match": "\\b([a-z]\\w*)\\b\\s*(:.*)(?=,)",
					"captures": {
						"1": { "name": "variable.name.grain" },
						"2": {
							"patterns": [
								{ "include": "#type-annotations" }
							]
						}
					}
				},
				{
					"match": "\\b([a-z]\\w*)\\b\\s*(:.*)(?=\\))",
					"captures": {
						"1": { "name": "variable.name.grain" },
						"2": {
							"patterns": [
								{ "include": "#type-annotations" }
							]
						}
					}
				},
				{ "include": "#identifier" }
			]
		},
		"constant": {
			"patterns": [
				{ "include": "#number" },
				{ "include": "#strings" },
				{ "include": "#boolean" }
			]
		},
		"boolean": {
			"patterns": [
				{
					"match": "\\b(True|False)\\b",
					"name": "constant.language.grain"
				}
			]
		},
		"number": {
			"patterns": [
				{
					"match": "\\b\\d+\\b",
					"name": "constant.numeric.grain"
				}
			]
		},
		"tuple": {
			"patterns": [
				{
					"begin": "\\(",
					"end": "\\)(?!\\s*=>)",
					"patterns": [
						{ "include": "#expressions" }
					]
				}
			]
		},
		"imports": {},
		"exports": {
			"patterns": [
				{
					"match": "\\b(export)\\b\\s*(\\*)\\s*\\b(except)\\b(.*?)(?=$|;)",
					"captures": {
						"1": { "name": "keyword.control.grain" },
						"2": { "name": "punctuation.support.grain" },
						"3": { "name": "keyword.control.grain" },
						"4": { "patterns": [{
								"include": "#expressions"
							}]
						}
					}
				},
				{
					"match": "\\b(export)\\b\\s*(\\*)",
					"captures": {
						"1": { "name": "keyword.control.grain" },
						"2": { "name": "punctuation.support.grain" }
					}
				}
			]
		},
		"foreigns": {
			"patterns": [
				{
					"match": "\\b(foreign)\\b((\\s*\\b\\w+\\b){3})\\s*(:.*?)?(?=$|;)",
					"captures": {
						"1": { "name": "keyword.control.grain" },
						"2": {
							"patterns": [{
								"match": "\\b(\\w+)\\b\\s*\\b(\\w+)\\b\\s*\\b(\\w+)\\b",
								"captures": {
									"1": { "name": "variable.language.grain" },
									"2": { "name": "support.constant.grain" }
								}
							}]
						},
						"4": {
							"patterns": [{
								"match": "(:.*)",
								"captures": {
									"1": { "patterns": [{ "include": "#type-annotations" }] }
								}
							}]
						}
					}
				}
			]
		},
		"strings": {
			"patterns": [
				{
					"name": "string.quoted.double.grain",
					"begin": "\"",
					"end": "\"",
					"patterns": [
						{
							"name": "constant.character.escape.grain",
							"match": "\\\\."
						}
					]
				},
				{
					"name": "string.quoted.single.grain",
					"begin": "'",
					"end": "'",
					"patterns": [
						{
							"name": "constant.character.escape.grain",
							"match": "\\\\."
						}
					]
				}
			]
		},
		"keywords": {
			"patterns": [
				{
					"match": "\\b(throw|box|unbox|let|rec|while|import|export|foreign|from|except)\\b",
					"name": "keyword.control.grain"
				}
			]
		},
		"top-level-statements": {
			"patterns": [
				{ "include": "#imports" },
				{ "include": "#exports" },
				{ "include": "#foreigns" },
				{ "include": "#data-declarations" },
				{ "include": "#expressions" },
				{ "include": "#comments" },
				{
					"match": "(;)",
					"captures": {
						"1": { "name": "punctuation.definition.parameters.grain" }
					}
				}
			]
		},
		"program": {
			"patterns": [
				{ "include": "#top-level-statements" }
			]
		},
		"type-var": {
			"patterns": [
				{
					"match": "([a-z]\\w*)",
					"captures": {
						"1": { "name": "variable.language.grain" }
					}
				},
				{
					"match": "([A-Z]\\w*)",
					"captures": {
						"1": { "name": "entity.name.type.grain" }
					}
				},
				{
					"begin": "([A-Z]\\w*)<",
					"end": ">",
					"captures": {
						"1": { "name": "support.type.grain" }
					},
					"patterns": [
						{ "include": "#type-var" }
					]
				},
				{
					"begin": "\\(",
					"end": "\\)",
					"patterns": [
						{
							"include": "#type-var"
						}
					]
				}
			]
		},
		"type-vector": {
			"patterns": [
				{
					"begin": "(<)",
					"end": "(>)",
					"patterns": [
						{ "include": "#type-var" },
						{ "include": "#type-constructor" }
					]
				}
			]
		},
		"type-variant": {
			"patterns": [
				{
					"begin": "\\b([A-Z]\\w*)\\b\\s*(\\()",
					"end": "(\\))",
					"beginCaptures": {
						"1": { "name": "support.type.grain" },
						"2": { "name": "support.type.grain" }
					},
					"endCaptures": {
						"1": { "name": "support.type.grain" }
					},
					"patterns": [
						{
							"match": "(,)",
							"captures": {
								"1": { "name": "support.type.grain" }
							}
						},
						{ "include": "#type-var" }
					]
				},
				{
					"match": "\\b([A-Z]\\w*)\\b",
					"captures": {
						"1": { "name": "support.type.grain" }
					}
				}
			]
		},
		"type-variant-constructor": {
			"patterns": [
				{
					"begin": "\\b([A-Z]\\w*)\\b\\s*(\\()",
					"end": "(\\))",
					"beginCaptures": {
						"1": { "name": "support.type.grain" },
						"2": { "name": "support.type.grain" }
					},
					"endCaptures": {
						"1": { "name": "support.type.grain" }
					},
					"patterns": [
						{
							"match": "(,)",
							"captures": {
								"1": { "name": "support.type.grain" }
							}
						},
						{ "include": "#expressions" }
					]
				},
				{
					"match": "\\b([A-Z]\\w*)\\b",
					"captures": {
						"1": { "name": "support.type.grain" }
					}
				}
			]
		},
		"type-destructor-tuple": {
			"patterns": [
				{
					"begin": "\\(",
					"end": "\\)",
					"patterns": [
						{ 
							"match": "\\b([a-z]\\w*)\\b",
							"captures": {
								"1": { "name": "variable.name.grain" }
							}
						},
						{ 
							"match": "\\b(_)\\b",
							"captures": {
								"1": { "name": "meta.separator.grain" }
							}
						},
						{ "include": "#type-destructor" }
					]
				}
			]
		},
		"type-destructor": {
			"patterns": [
				{
					"begin": "\\b([A-Z]\\w*)\\b(?=\\s*\\()",
					"end": "(?<=\\))",
					"beginCaptures": {
						"1": { "name": "support.type.grain" }
					},
					"patterns": [
						{
							"begin": "(\\()",
							"end": "(\\))",
							"captures": {
								"1": { "name": "support.type.grain" }
							},
							"patterns": [
								{
									"match": "\\b([a-z]\\w*)\\b",
									"captures": {
										"1": { "name": "variable.language.grain" }
									}
								},
								{
									"match": "\\b(_)\\b",
									"captures": {
										"1": { "name": "meta.separator.grain" }
									}
								},
								{
									"match": "(,)",
									"captures": {
										"1": { "name": "support.type.grain" }
									}
								},
								{
									"include": "#type-destructor"
								}
							]
						}
					]
				},
				{
					"match": "\\b([A-Z]\\w*)\\b",
					"captures": {
						"1": { "name": "support.type.grain" }
					}
				},
				{ "include": "#type-destructor-tuple" }
			]
		},
		"pattern-variant": {
			"patterns": [
				{
					"begin": "(=>)",
					"end": "(?=\\||\\})",
					"beginCaptures": {
						"1": { "name": "support.type.grain" }
					},
					"patterns": [
						{ "include": "#expressions" }
					]
				},
				{
					"begin": "",
					"end": "(?==>|\\|\\})",
					"patterns": [
						{ "include": "#comments" },
						{
							"include": "#type-destructor"
						}
					]
				}
			]
		},
		"match": {
			"patterns": [
				{
					"begin": "(?=\\b(match)\\b\\s*\\(.*\\)\\s*\\{)",
					"end": "(?<=\\})",
					"patterns": [
						{
							"begin": "(\\{)",
							"end": "(\\})",
							"beginCaptures": {
								"1": { "name": "punctuation.definition.parameters.begin.grain" }
							},
							"endCaptures": {
								"1": { "name": "punctuation.definition.parameters.end.grain" }
							},
							"patterns": [
								{
									"include": "#pattern-variant"
								}
							]
						},
						{
							"begin": "\\b(match)\\b\\s*(\\()",
							"end": "(\\))",
							"beginCaptures": {
								"1": { "name": "keyword.operator.grain" },
								"2": { "name": "punctuation.definition.parameters.begin.grain" }
							},
							"endCaptures": {
								"1": { "name": "punctuation.definition.parameters.end.grain" }
							},
							"patterns": [
								{
									"include": "#expressions"
								}
							]
						}
					]
				}
			]
		},
		"pattern": {
			"patterns": [
				{
					"begin": "\\b(pattern)\\b\\s*(?=\\{)",
					"end": "(?<=\\})",
					"beginCaptures": {
						"1": { "name": "keyword.operator.grain" }
					},
					"patterns": [
						{
							"begin": "(?<=\\||\\{)",
							"end": "(?=\\||\\})",
							"patterns": [
								{
									"include": "#pattern-variant"
								}
							]
						},
						{
							"match": "\\{",
							"name": "punctuation.definition.parameters.begin.grain"
						},
						{
							"match": "\\}",
							"name": "punctuation.definition.parameters.end.grain"
						}
					]
				}
			]
		}
	},
	"scopeName": "source.grain"
}